#!/bin/bash

set -e

heroku container:login

APP=$(heroku apps:info --json | jq -r '.app.name')

read -p "Ready to deploy ${APP} to heroku? (y/n)" -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]
then
	heroku container:push web $(cat .env | grep -v "#" | xargs printf -- '--arg %s\n' | xargs)
	sleep 5s
	heroku container:release web

	WEB_URL=$(heroku apps:info --json | jq -r '.app.web_url')

	echo "your app is online at ${WEB_URL}"
	
	open $WEB_URL
fi
